import{createRef as e,createContext as t,useRef as n,createElement as i,useContext as r,useCallback as o,useEffect as s,useState as a}from"react";import{EventEmitter as d,DisposableCollection as l}from"@stoplight/lifecycle";import{observable as c,computed as h,configure as u,action as p}from"mobx";import{Classes as f,Menu as g,ContextMenu as m,Popover as v,Position as y,Callout as N,Intent as x,Icon as w}from"@stoplight/ui-kit";import C from"classnames";import{observer as b}from"mobx-react-lite";import{ErrorBoundary as E}from"@stoplight/react-error-boundary";import{FixedSizeList as O,VariableSizeList as D}from"@stoplight/ui-kit/ScrollList";var I,T;function L(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&(n[i[r]]=e[i[r]])}return n}function k(e,t,n,i){var r,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}function j(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function R(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{d(i.next(e))}catch(e){o(e)}}function a(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(s,a)}d((i=i.apply(e,t||[])).next())})}!function(e){e.NodeClick="node.click",e.NodeMouseEnter="node.mouseenter",e.NodeMouseLeave="node.mouseexit",e.NodeDoubleClick="node.doubleClick",e.NodeCaretClick="node.caretClick",e.NodeExpand="node.expand",e.Drop="drop",e.EditCancel="edit.cancel",e.ValidationError="edit.validationError",e.BeforeEditComplete="edit.beforecomplete",e.AfterEditComplete="edit.aftercomplete"}(I||(I={})),function(e){e.Right="right",e.Down="down"}(T||(T={}));const S=()=>Math.random().toString(36).slice(2);class P{constructor(e){this.size=e,this.head=-1,this.tail=-1,this.cache=new Map}set(e,t){(-1===this.head||e<this.head)&&(this.head=e),(-1===this.tail||e>this.tail)&&(this.tail=e),this.cache.size===this.size&&(e<=this.head?(this.cache.delete(this.tail),this.tail--):(this.cache.delete(this.head),this.head++)),this.cache.set(e,t)}get(e){return e<0?void 0:this.cache.get(e)}clear(e){if(e<=this.head)this.cache.clear();else{for(;e++<=this.tail;)this.cache.delete(e);this.tail=e}}}function A(e){if(null==e||!("children"in e))throw new TypeError("Parent node expected")}const F=Symbol("COUNT"),M=Symbol("LEVEL"),Z=Symbol("DROP_ZONE_ID"),_=[];class z{constructor(e=null,t=z.createArtificialRoot(),n=200){this.iterationOptions=e,this.tree=t,this.wrapped=new WeakSet,this.sorted=new WeakSet,this.filtered=new WeakMap,this._count=0,this._root=t,this.indexLookup=new P(n),this.count=this.processTreeFragment(this.root)}get root(){return this._root}get count(){return this._count}set count(e){this._count=e}static getLevel(e){return e[M]}static getDropZoneId(e){return e[Z]}clearCache(){this.indexLookup.clear(0)}getFilteredChildren(e){if(this.wrapped.has(e))return _;if(0===e.children.length||null===this.iterationOptions||null===this.iterationOptions.filter)return e.children;const t=this.filtered.get(e);if(void 0!==t)return t;const n=e.children.filter(this.iterationOptions.filter);return this.filtered.set(e,n),n}getChildren(e){const t=this.getFilteredChildren(e);return null===this.iterationOptions||0===t.length?t:(null===this.iterationOptions.order||this.sorted.has(e)||(t.sort(this.iterationOptions.order),this.sorted.add(e)),t)}static _toTree(e,t){const n=[e];let i=e;for(const e of t){let t;const r=z.transformDeprecatedNode(e,null);e.canHaveChildren?(t=n[e.level],n.push(r)):e.level===n.length?((t=i).children=[],n.push(t)):(t=n[e.level],n.length=e.level+1),r.parent=t,t.children.push(r),i=r}}static createArtificialRoot(){return{id:S(),name:"",parent:null,children:[]}}static toTree(e){const t={id:S(),name:"",parent:null,children:[]};return z._toTree(t,e.slice()),t}*[Symbol.iterator](){yield*this.getIteratorForNode(this.tree)}*getIteratorForNode(e){for(const t of this.getChildren(e))yield t,"children"in t&&(yield*this.getIteratorForNode(t))}static getOffsetForNode(e){return-1}_itemAt(e,t,n){if(t<0)return;const i=this.indexLookup.get(t);if(void 0!==i)return i;const{length:r}=n;for(const i of this.getChildren(e)){if(n.offset++,t===n.offset-1)return this.indexLookup.set(t,i),i;if("children"in i&&n.offset-1<=t&&t<=n.offset-1+r){n.length=i[F];const e=this._itemAt(i,t,n);if(void 0!==e)return e}else F in i&&(n.offset+=i[F])}}static getLastItem(e){return"children"in e?0===e.children.length?e:z.getLastItem(e.children[e.children.length-1]):e}static getNodeIndex(e){return null===e.parent?-1:e.parent.children.indexOf(e)}static nextItem(e){if(null===e.parent)return;const t=z.getNodeIndex(e);return t<e.parent.children.length-1?e.parent.children[t+1]:z.nextItem(e.parent)}nextItem(e){return"children"in e&&e.children.length>0?e.children[0]:z.nextItem(e)}prevItem(e){if(null===e.parent)return;const t=z.getNodeIndex(e);return t>0?z.getLastItem(e.parent.children[t-1]):void 0}itemAt(e){if(!(e<0)){if(e<this.count&&this.indexLookup.tail+1===e){const t=this.indexLookup.get(this.indexLookup.tail);if(t){const n=this.nextItem(t);if(n)return this.indexLookup.set(e,n),n}}else if(e>1&&this.indexLookup.head-1===e){const t=this.indexLookup.get(this.indexLookup.head);if(t){const n=this.prevItem(t);if(n)return this.indexLookup.set(e,n),n}}return z.boundaries.offset=0,z.boundaries.length=this.count,this._itemAt(this.tree,e,z.boundaries)}}indexOf(e){let t=0;for(const n of this){if(e===n)return t;t++}return-1}every(e,t){let n=0;for(const i of this)if(!e.call(t,i,n++,[]))return!1;return!0}findById(e){for(const t of this)if(t.id===e)return t}invalidate(){this.wrapped=new WeakSet,this.sorted=new WeakSet,this.filtered=new WeakMap,this.invalidateLevel(this.root),this.invalidateCounter(this.root,!0),this.count=this.processTreeFragment(this.root)}invalidateCounter(e,t){let n=e;do{this.resetCounter(n),n=n.parent}while(t&&null!==n)}invalidateLevel(e){if(z.resetLevel(e),"children"in e)for(const t of e.children)this.invalidateLevel(t)}invalidateChildren(e){this.filtered.delete(e),this.sorted.delete(e)}wrap(e){this.wrapped.has(e)||(this.clearCache(),e.children.length>0&&(this.count-=e[F]),this.wrapped.add(e),this.invalidateCounter(e,null!==e.parent&&!this.wrapped.has(e.parent)))}unwrap(e){this.wrapped.has(e)&&(this.clearCache(),this.wrapped.delete(e),this.invalidateCounter(e,null!==e.parent&&!this.wrapped.has(e.parent)),e.children.length>0&&(this.count+=e[F]))}moveNode(e,t){null!==e.parent&&this.invalidateCounter(e.parent,!0),this.decorateNode(e),e.parent=t,t.children.push(e),this.clearCache(),this.invalidateCounter(t,!0),this.invalidateLevel(e)}insertNode(e,t){let n=1;this.decorateNode(e),e.parent=t,t.children.push(e),this.clearCache(),this.invalidateCounter(t,!0),this.invalidateLevel(e),"children"in e&&e.children.length>0&&(n+=this.processTreeFragment(e)),this.count+=n}insertTreeFragment(e,t){let n=0;for(const i of e)this.decorateNode(i),i.parent=t,t.children.push(i),this.invalidateLevel(i),"children"in i&&i.children.length>0&&(n+=this.processTreeFragment(i)),n++;this.clearCache(),this.invalidateCounter(t,!0),this.count+=n}removeNode(e){if(null===e.parent)throw new Error("Cannot remove root node");let t=-1;const{parent:n}=e;n.children.splice(n.children.indexOf(e),1),this.clearCache(),this.invalidateCounter(n,!0),"children"in e&&(t-=e[F]),this.count+=t}replaceNode(e,t){if(null===e.parent)return A(t),this._root=t,this.decorateNode(t),t.parent=null,void this.invalidate();let n=-1;const{parent:i}=e;i.children[i.children.indexOf(e)]=t,this.decorateNode(t),this.clearCache(),this.invalidateCounter(i,!0),"children"in e&&(n-=e[F]),this.count+=n}getCount(e){return e[F]}resetCounter(e){if("children"in e){let t=0;for(const n of this.getFilteredChildren(e))F in n&&(t+=n[F]),t+=1;e[F]=t}}processTreeFragment(e){let t=0;if(this.decorateNode(e),"children"in e){if(null===this.iterationOptions||null===this.iterationOptions.expanded||this.iterationOptions.expanded(e))for(const n of this.getFilteredChildren(e))"children"in n?t+=this.processTreeFragment(n):this.decorateNode(n),t+=1;else this.wrapped.add(e);e[F]=t}return t}static resetLevel(e){Object.defineProperty(e,M,z.level)}static resetDropZoneId(e){Object.defineProperty(e,Z,z.dropZoneId)}decorateNode(e){M in e||z.resetLevel(e),Z in e||z.resetDropZoneId(e)}static isDecoratedNode(e){return"object"==typeof e&&null!==e&&M in e&&Z in e}static isParentNode(e){return"children"in e}static transformDeprecatedNode(e,t){const n=Object.assign(Object.assign(Object.assign({},e),e.canHaveChildren&&{children:[]}),{parent:t});return delete n.level,delete n.canHaveChildren,n}}z.level={configurable:!0,get(){const{parent:e}=this,t=null===e?-1:(M in e?e[M]:0)+1;return"children"in this&&Object.defineProperty(this,M,{configurable:!0,value:t}),t}},z.dropZoneId={configurable:!0,get(){const{parent:e}=this,t=`${null!==e&&Z in e?`${e[Z]}${this.id}`:this.id}-`;return"children"in this&&Object.defineProperty(this,Z,{configurable:!0,value:t}),t}},z.boundaries={offset:0,length:0},k([c,j("design:type",Object)],z.prototype,"_count",void 0),k([h,j("design:type",Object),j("design:paramtypes",[Object])],z.prototype,"count",null);class W{constructor(e){var t,n,i,r,o,s;this.expanded=null!=(n=null===(t=e)||void 0===t?void 0:t.expanded)?n:{},this.activeNodeId=null!=(r=null===(i=e)||void 0===i?void 0:i.activeNodeId)?r:null,this.editedNodeId=null!=(s=null===(o=e)||void 0===o?void 0:o.editedNodeId)?s:null}}k([c.shallow,j("design:type",Object)],W.prototype,"expanded",void 0),k([c,j("design:type",Object)],W.prototype,"activeNodeId",void 0),k([c,j("design:type",Object)],W.prototype,"editedNodeId",void 0);class $ extends z{constructor(e,t,n=null){const i=t(e);super(n,i),this.transformNode=t,this.transformedNodes=new WeakMap([[e,i]]),this.transformChildren(i),this.processTreeFragment(this.root),this.count=this.getCount(this.tree)}transform(e,t){const n=this.transformNode(e);return n.parent=t,n}transformChildren(e){e.children=e.children.map(t=>{const n=this.transformNode(t);return n.parent=e,super.decorateNode(n),n})}decorateNode(e){if($.isDecoratedNode(e))return;const t=this.transform(e,e.parent&&this.transformedNodes.get(e.parent)||null);"children"in e&&(this.transformedNodes.set(e,t),this.transformChildren(t)),super.decorateNode(t)}}class B extends z{constructor(e,t=null,n=z.createArtificialRoot(),i=200){super(t,n,i),this.visited=new WeakSet,this.computeRows=e,this.computeTree(n).then(e=>{this.insertTreeFragment(e,n)}).catch(()=>{})}computeTree(e){return R(this,void 0,void 0,function*(){const t=yield this.computeRows(e);for(const e of t)z.resetLevel(e),"children"in e&&(null===this.iterationOptions||null===this.iterationOptions.expanded||this.iterationOptions.expanded(e))&&(e.children=yield this.computeTree(e),yield this.computeTree(e));return t})}unwrap(e){const t=Object.create(null,{unwrap:{get:()=>super.unwrap}});return R(this,void 0,void 0,function*(){if(t.unwrap.call(this,e),0===e.children.length&&!this.visited.has(e))try{this.insertTreeFragment(yield this.computeTree(e),e)}finally{this.visited.add(e)}})}invalidate(){this.visited=new WeakSet,super.invalidate()}}u({enforceActions:"observed"});class H{constructor(t,n,i){this.state=n,this.icons={},this.defaultExpandedDepth=0,this.instanceRef=e(),this.events=new d,this.setActiveNode=(e=>{this.state.activeNodeId=e}),this.setEditedNode=(e=>{this.state.editedNodeId=e}),this.scrollToItem=(e=>{if(!this.instanceRef.current)return;"children"in e&&this.toggleExpand(e,!0);const t=this.tree.indexOf(e);-1!==t&&this.instanceRef.current.scrollToItem(t,"start")}),this.rename=((e,t)=>R(this,void 0,void 0,function*(){this.setEditedNode(e);const n=new l;try{return yield new Promise((e,i)=>{n.pushAll([this.events.on(I.BeforeEditComplete,(e,n)=>R(this,void 0,void 0,function*(){try{void 0!==t&&(yield t(e,n)),this.events.emit(I.AfterEditComplete,e,n)}catch(e){this.events.emit(I.ValidationError,e)}})),this.events.on(I.AfterEditComplete,e),this.events.on(I.EditCancel,i)])})}finally{n.dispose(),this.setEditedNode(null)}})),this.tree=t,Object.assign(this,i),this.placeholderId=S()}dispose(){this.events.dispose()}toggleExpand(e,t){A(e);const{expanded:n}=this.state;if(void 0===t||t!==n[e.id]){const n=this.state.expanded[e.id]=null!=t?t:!this.isNodeExpanded(e);this.events.emit(I.NodeExpand,e,n),n?this.tree.unwrap(e):this.tree.wrap(e)}if(!this.isNodeExpanded(e))return;const i=e.parent;null!==i&&null!==i.parent&&this.toggleExpand(i,!0)}expandAll(e){for(const t of this.tree)"children"in t&&null!==t.parent&&(void 0===e||e(t))&&this.toggleExpand(t,!0)}collapseAll(e){for(const t of this.tree)"children"in t&&null!==t.parent&&(void 0===e||e(t))&&this.toggleExpand(t,!1)}static isNodeExpanded(e,t,n){return!(e.id in t)&&z.getLevel(e)<=n||!0===t[e.id]}isNodeExpanded(e){return H.isNodeExpanded(e,this.state.expanded,this.defaultExpandedDepth)}isAllExpanded(){return this.tree.every(e=>null===e.parent||!("children"in e)||this.isNodeExpanded(e))}isAllCollapsed(){return this.tree.every(e=>!(null!==e.parent&&"children"in e&&this.isNodeExpanded(e)))}create(e,t,n){return R(this,void 0,void 0,function*(){const i=null===t?this.tree.root:this.tree.findById(t);A(i);const r=Object.assign(Object.assign({name:""},e),{parent:i});this.tree.insertNode(r,i),this.toggleExpand(i,!0);try{return yield this.rename(e.id,n)}catch(e){throw this.tree.removeNode(r),e}})}}k([c.shallow,j("design:type",z)],H.prototype,"tree",void 0),k([c,j("design:type",Object)],H.prototype,"icons",void 0),k([p,j("design:type",Object)],H.prototype,"setActiveNode",void 0),k([p,j("design:type",Object)],H.prototype,"setEditedNode",void 0),k([p,j("design:type",Function),j("design:paramtypes",[Object,Boolean]),j("design:returntype",void 0)],H.prototype,"toggleExpand",null);class G{constructor(){this.attach=(e=>{null!==this.node&&(document.body.appendChild(this.node),e.dataTransfer.setDragImage(this.node,-10,-10),setTimeout(this.detach,0))}),this.detach=(()=>{var e;null===(e=this.node)||void 0===e||e.remove()}),"undefined"!=typeof document?(this.node=document.createElement("span"),this.node.className=C(f.TAG,f.ROUND),this.node.style.zIndex=String(Math.pow(2,23)-10)):this.node=null}get content(){var e,t;return null!=(t=null===(e=this.node)||void 0===e?void 0:e.textContent)?t:null}set content(e){null!==this.node&&(this.node.textContent=e)}}const V=e=>Object.entries(e).map(e=>e.join(":")).join(";");function K(e){if("undefined"==typeof document)return;const t=document.createElement("style");return t.textContent=e,document.body.appendChild(t)}class U{constructor(e){this.rootZoneId=e,this.cache=new WeakMap}setGenericStyles(){this.genericStyle=K(U.generateStyles("[data-drop-zone-id]:hover",{"background-color":"inherit",color:"inherit"}))}clearGenericStyles(){void 0!==this.genericStyle&&(this.genericStyle.remove(),this.genericStyle=void 0)}setRange(e){const t=K(U.generateStyles(null===e.parent?`[data-root-drop-zone="${this.rootZoneId}"] [data-drop-zone-id]:not([data-active-tree-node])`:`[data-drop-zone-id^="${z.getDropZoneId(e)}"]:not([data-active-tree-node])`,{"background-color":"var(--highlighted-bg) !important",color:"var(--highlighted-fg) !important"}));void 0!==t&&this.cache.set(e,t)}clearRange(e){const t=this.cache.get(e);void 0!==t&&(t.remove(),this.cache.delete(e))}static generateStyles(e,t){return`\n      ${e} { ${V(t)} }\n    `}}class Y{constructor(){this.dropPermissions=new Map,this.id=Y.seed++,this.highlighter=new U(this.id),this.ghost=new G}clear(){void 0!==this.currentDragZone&&this.highlighter.clearRange(this.currentDragZone),this.highlighter.clearGenericStyles(),void 0!==this.collapseTimeout&&(this.collapseTimeout=clearTimeout(this.collapseTimeout)),this.initialNode=void 0,this.initialDragZone=void 0,this.currentDragZone=void 0,this.dropPermissions.clear()}}Y.seed=0;const X=t({store:new H(new z,new W),draggable:new Y}),q=t({}),J=({store:e,className:t,innerClassName:r,itemClassName:o,children:s})=>{const a={draggable:n(new Y).current,store:e},d={itemClassName:o,innerClassName:r,className:t};return i(X.Provider,{value:a},i(q.Provider,{value:d},s))},Q=e=>{return r(q)[e]},ee=e=>e.map((e,t)=>{const{divider:n,children:r}=e,o=L(e,["divider","children"]);return n?i(g.Divider,Object.assign({key:t},o)):i(g.Item,Object.assign({key:t},o),r&&r.length?ee(r):null)}),te=e=>i(g,null,ee(e.items));function ne(){return r(X).draggable}function ie(){return r(X).store}const re=(e,t)=>{const{state:{activeNodeId:n}}=ie(),r=ne();return o(o=>{if(o.preventDefault(),o.stopPropagation(),!(t&&null!==e&&"children"in e))return;const s=t(e);s&&s.length&&(n!==e.id&&null!==e.parent&&r.highlighter.setRange(e),m.show(i(te,{items:s}),{left:o.clientX,top:o.clientY},()=>{r.highlighter.clearRange(e)}))},[t,n,r,e])},oe=(e,t)=>{const n=ie();return o(i=>{null!==t&&n.events.emit(e,i,t)},[n,e,t])},se=({children:e,className:t,style:n,onContextMenu:r})=>{const a=ie(),d=ne();s(()=>()=>{d.clear()},[d]);const l=o(e=>{void 0!==d.currentDragZone&&d.dropPermissions.get(d.currentDragZone.id)&&e.preventDefault()},[d]),c=o(()=>{d.clear()},[d]),h=o(e=>{e.preventDefault();const{initialNode:t,currentDragZone:n}=d;if(void 0!==t&&void 0!==n)try{a.events.emit(I.Drop,t,n)}catch(e){console.error("Exception thrown in drop handler",e)}d.clear()},[d,a]);return i("div",{className:t,style:n,"data-root-drop-zone":d.id,onDrop:h,onDragOver:l,onDragEnd:c,onContextMenu:r},e)},ae=b(e=>{const{node:t,tree:n,autoExpandDelay:s,canDrop:a,canDrag:d,rowHeight:l,rowRenderer:c,className:h}=e,u=L(e,["node","tree","autoExpandDelay","canDrop","canDrag","rowHeight","rowRenderer","className"]),{draggable:p}=r(X),f=ie(),g="children"in t?t:t.parent;if(null===g)throw new Error("Cannot drag root node");const m=o(e=>{const{dropPermissions:n,currentDragZone:i,initialDragZone:r,collapseTimeout:o,initialNode:d,highlighter:l}=p;if(void 0!==o&&(p.collapseTimeout=clearTimeout(o)),void 0===r||void 0===d)return;let c=n.get(e.id);void 0===c&&(c=void 0===a||a(d,e),n.set(e.id,!!c)),void 0!==i&&l.clearRange(i),e.id!==r.id&&c?(p.currentDragZone=e,l.setRange(e),"children"in t&&(p.collapseTimeout=setTimeout(f.toggleExpand,s,t,!0))):p.currentDragZone=void 0},[t,f.toggleExpand,g,p,a]),v=o(()=>{m(g)},[g,m]),y=o(e=>{if(void 0!==d&&!d(t))return void e.preventDefault();p.currentDragZone=g,p.initialDragZone=g,p.initialNode=t;const n=t.parent;n&&p.dropPermissions.set(n.id,!1),p.highlighter.setGenericStyles(),e.dataTransfer.effectAllowed="copyMove",e.dataTransfer.setData("text/plain",t.id),p.ghost.content=t.name,p.ghost.attach(e),"children"in t&&f.toggleExpand(t,!1)},[t,f.toggleExpand,p,d]),N=o(e=>{e.relatedTarget&&"closest"in e.relatedTarget&&!e.relatedTarget.closest("[data-drop-zone-id]")&&e.relatedTarget.closest("[data-root-drop-zone]")&&m(n.root)},[m,n.root]);return i("div",Object.assign({},u,{className:h,draggable:!0,onDragStart:y,onDragEnter:v,onDragLeave:N}))}),de=b(({className:e,node:t,placeholder:r})=>{const d=ie(),[l,c]=a(null),h=n();s(()=>d.events.on(I.ValidationError,e=>{c(e.message)}).dispose,[d,c]),s(()=>{const{current:e}=h;if(e){const t=e.value.indexOf(".");e.setSelectionRange(0,-1===t?e.value.length:t,"forward")}},[h.current]);const u=o(e=>{""!==e.target.value&&c(null)},[]),p=o(e=>{switch(e.key){case"Enter":const n=Object.assign(Object.assign({},t),{name:h.current.value});d.events.emit(I.BeforeEditComplete,n,t.parent);break;case"Escape":f()}},[t,h.current]),f=o(()=>{d.events.emit(I.EditCancel)},[d]),g=o(e=>{const t=e.target.value,n=t.indexOf(".");e.target.setSelectionRange(0,-1===n?t.length:n,"forward")},[]);return i(v,{minimal:!0,isOpen:null!==l,usePortal:!0,position:y.BOTTOM_RIGHT,target:i("input",{autoFocus:!0,autoComplete:"off",ref:h,className:C(e,"TreeListItem__input"),onKeyDown:p,onInput:u,onBlur:f,onFocus:g,defaultValue:t.name,placeholder:r}),content:i(N,{intent:x.DANGER},l)})}),le={[T.Down]:{default:"chevron-down"},[T.Right]:{default:"chevron-right"}},ce=e=>{var{expanded:t,node:n,store:r,children:o}=e;L(e,["expanded","node","store","children"]);let s=null;if("children"in n){const e=t?T.Down in r?r[T.Down]:le[T.Down]:T.Right in r?r[T.Right]:le[T.Right],o="function"==typeof e?e(n):e;o&&(s=i(w,{iconSize:11,icon:o.default,className:C(o.color&&`text-${o.color}`)}))}return i("span",{className:"TreeListItem__caret"},s)},he=({expanded:e,store:t,node:n})=>{const r=n.type&&t[n.type]||void 0,o="function"==typeof r?r(n):r;if(!o)return null;const s=e&&o.expanded||o.default;return i("span",{className:"TreeListItem__icon"},"blank"!==s?i(w,{icon:s,color:o.color}):null)},ue=800,pe=30,fe=b(({className:e,isExpanded:t,isEdited:n,isExpandable:r,node:o,placeholder:s})=>{const a=ie(),d=oe(I.NodeCaretClick,o);return i("div",{className:C("flex-1 flex items-center",e),style:Object.assign({paddingLeft:15*z.getLevel(o)},o.style)},r&&i(ce,{onClick:d,expanded:t,store:a.icons,node:o}),i(he,{expanded:t,store:a.icons,node:o}),n?i(de,{node:o,placeholder:s}):i("span",{className:"TreeListItem__label",title:o.name},o.name))}),ge=b(e=>{const{data:t,index:n,style:r}=e,{innerPadding:o,tree:s,rowRenderer:a,generateContextMenu:d,striped:l}=t,c=L(t,["innerPadding","tree","rowRenderer","generateContextMenu","striped"]),h=Q("itemClassName"),u=ie(),p=o?n-1:n,f=-1===p?null:s.itemAt(p);if(void 0===f)throw new Error("Could not find node.");const g=oe(I.NodeClick,f),m=oe(I.NodeMouseEnter,f),v=oe(I.NodeMouseLeave,f),y=re(f,d);if(null===f)return i("div",{style:r});const N=u.state.editedNodeId===f.id,x=u.state.activeNodeId===f.id,w="children"in f&&u.isNodeExpanded(f),b=C(`TreeListItem TreeListItem--${z.getLevel(f)}`,f.className,h,{"TreeListItem--active":x,"TreeListItem--striped":l&&p%2!=0});let E;E="function"==typeof a?a(f,{isEdited:N,isExpanded:w}):i(fe,{node:f,isEdited:N,isExpanded:w});const O=Object.assign(Object.assign({},r),o&&r&&r.top&&{top:Number(r.top)-o});return u.state.editedNodeId===f.id?i("div",{key:f.id,className:b,style:O},E):i(ae,Object.assign({key:f.id,className:b,"data-drop-zone-id":z.getDropZoneId(f),node:f,onClick:g,onMouseEnter:m,onMouseLeave:v,onContextMenu:y,tree:s,style:O},x&&{"data-active-tree-node":!0},c),E)}),me=b(e=>{const{autoExpandDelay:t=ue,rowHeight:n=pe,rowRenderer:r,canDrag:a,canDrop:d,generateContextMenu:l,style:c,striped:h,innerPadding:u,maxRows:p,interactive:f=!0}=e,g=ie(),m=Q("className"),v=Q("innerClassName"),y=re(g.tree.root,l),N=g.instanceRef,x=g.tree;if("boolean"==typeof u&&"function"==typeof n)throw new Error("You need to provide an absolute value for padding in case of VariableSizeList");const w="boolean"==typeof u?Number(n)/2:u,b=x.count+(w?1:0);s(()=>{null!==N.current&&"resetAfterIndex"in N.current&&N.current.resetAfterIndex(0,!0)},[b]);const E={canDrag:a,canDrop:d,autoExpandDelay:t,rowRenderer:r,rowHeight:n,innerPadding:w,tree:x,generateContextMenu:l,striped:h},I=o(e=>{var t;return w&&0===e?g.placeholderId:(null===(t=x.itemAt(w?e-1:e))||void 0===t?void 0:t.id)||""},[x,g.placeholderId,w]),T=o(e=>{if(0===e&&w)return 2*w;const t=w?e-1:0,i=x.itemAt(t);return"function"==typeof n&&void 0!==i?n(i,t):0},[x.count,n,w]),L={className:v,itemData:E,itemKey:I,itemCount:b,maxRows:p};return 0===b?null:i(se,{style:c,onContextMenu:y,className:C(m,"TreeList",f&&"TreeList--interactive",!p&&"h-full")},"function"!=typeof n?i(O,Object.assign({},L,{instanceRef:N,itemSize:n}),ge):i(D,Object.assign({},L,{instanceRef:N,itemSize:T}),ge))}),ve=({error:e})=>i("div",{className:"p-4"},i("b",null,"Error"),e&&`: ${e.message}`),ye=e=>{var{onError:t,FallbackComponent:n=ve,store:r,className:o,innerClassName:s,itemClassName:a}=e,d=L(e,["onError","FallbackComponent","store","className","innerClassName","itemClassName"]);return i(E,{onError:t,FallbackComponent:n},i(J,{store:r,className:o,itemClassName:a,innerClassName:s},i(me,Object.assign({},d))))};ye.displayName="TreeList";export{B as ComputableTree,$ as GenericTree,z as Tree,ye as TreeList,T as TreeListCaretIcons,de as TreeListEditableItem,I as TreeListEvents,fe as TreeListRow,W as TreeState,H as TreeStore};
//# sourceMappingURL=index.es.js.map
