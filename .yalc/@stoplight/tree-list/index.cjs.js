"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var React=require("react"),lifecycle=require("@stoplight/lifecycle"),mobx=require("mobx"),uiKit=require("@stoplight/ui-kit"),cn=_interopDefault(require("classnames")),mobxReactLite=require("mobx-react-lite"),reactErrorBoundary=require("@stoplight/react-error-boundary"),ScrollList=require("@stoplight/ui-kit/ScrollList");function __rest(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&(r[n[i]]=e[n[i]])}return r}function __decorate(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a}function __metadata(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function __awaiter(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{l(n.next(e))}catch(e){o(e)}}function s(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}l((n=n.apply(e,t||[])).next())})}!function(e){e.NodeClick="node.click",e.NodeMouseEnter="node.mouseenter",e.NodeMouseLeave="node.mouseexit",e.NodeDoubleClick="node.doubleClick",e.NodeCaretClick="node.caretClick",e.NodeExpand="node.expand",e.Drop="drop",e.EditCancel="edit.cancel",e.ValidationError="edit.validationError",e.BeforeEditComplete="edit.beforecomplete",e.AfterEditComplete="edit.aftercomplete"}(exports.TreeListEvents||(exports.TreeListEvents={})),function(e){e.Right="right",e.Down="down"}(exports.TreeListCaretIcons||(exports.TreeListCaretIcons={}));const generateRandomId=()=>Math.random().toString(36).slice(2);class IndexLookup{constructor(e){this.size=e,this.head=-1,this.tail=-1,this.cache=new Map}set(e,t){(-1===this.head||e<this.head)&&(this.head=e),(-1===this.tail||e>this.tail)&&(this.tail=e),this.cache.size===this.size&&(e<=this.head?(this.cache.delete(this.tail),this.tail--):(this.cache.delete(this.head),this.head++)),this.cache.set(e,t)}get(e){return e<0?void 0:this.cache.get(e)}clear(e){if(e<=this.head)this.cache.clear();else{for(;e++<=this.tail;)this.cache.delete(e);this.tail=e}}}function assertParentNode(e){if(null==e||!("children"in e))throw new TypeError("Parent node expected")}const COUNT=Symbol("COUNT"),LEVEL=Symbol("LEVEL"),DROP_ZONE_ID=Symbol("DROP_ZONE_ID"),EMPTY_CHILDREN_LIST=[];class Tree{constructor(e=null,t=Tree.createArtificialRoot(),r=200){this.iterationOptions=e,this.tree=t,this.wrapped=new WeakSet,this.sorted=new WeakSet,this.filtered=new WeakMap,this._count=0,this._root=t,this.indexLookup=new IndexLookup(r),this.count=this.processTreeFragment(this.root)}get root(){return this._root}get count(){return this._count}set count(e){this._count=e}static getLevel(e){return e[LEVEL]}static getDropZoneId(e){return e[DROP_ZONE_ID]}clearCache(){this.indexLookup.clear(0)}getFilteredChildren(e){if(this.wrapped.has(e))return EMPTY_CHILDREN_LIST;if(0===e.children.length||null===this.iterationOptions||null===this.iterationOptions.filter)return e.children;const t=this.filtered.get(e);if(void 0!==t)return t;const r=e.children.filter(this.iterationOptions.filter);return this.filtered.set(e,r),r}getChildren(e){const t=this.getFilteredChildren(e);return null===this.iterationOptions||0===t.length?t:(null===this.iterationOptions.order||this.sorted.has(e)||(t.sort(this.iterationOptions.order),this.sorted.add(e)),t)}static _toTree(e,t){const r=[e];let n=e;for(const e of t){let t;const i=Tree.transformDeprecatedNode(e,null);e.canHaveChildren?(t=r[e.level],r.push(i)):e.level===r.length?((t=n).children=[],r.push(t)):(t=r[e.level],r.length=e.level+1),i.parent=t,t.children.push(i),n=i}}static createArtificialRoot(){return{id:generateRandomId(),name:"",parent:null,children:[]}}static toTree(e){const t={id:generateRandomId(),name:"",parent:null,children:[]};return Tree._toTree(t,e.slice()),t}*[Symbol.iterator](){yield*this.getIteratorForNode(this.tree)}*getIteratorForNode(e){for(const t of this.getChildren(e))yield t,"children"in t&&(yield*this.getIteratorForNode(t))}static getOffsetForNode(e){return-1}_itemAt(e,t,r){if(t<0)return;const n=this.indexLookup.get(t);if(void 0!==n)return n;const{length:i}=r;for(const n of this.getChildren(e)){if(r.offset++,t===r.offset-1)return this.indexLookup.set(t,n),n;if("children"in n&&r.offset-1<=t&&t<=r.offset-1+i){r.length=n[COUNT];const e=this._itemAt(n,t,r);if(void 0!==e)return e}else COUNT in n&&(r.offset+=n[COUNT])}}static getLastItem(e){return"children"in e?0===e.children.length?e:Tree.getLastItem(e.children[e.children.length-1]):e}static getNodeIndex(e){return null===e.parent?-1:e.parent.children.indexOf(e)}static nextItem(e){if(null===e.parent)return;const t=Tree.getNodeIndex(e);return t<e.parent.children.length-1?e.parent.children[t+1]:Tree.nextItem(e.parent)}nextItem(e){return"children"in e&&e.children.length>0?e.children[0]:Tree.nextItem(e)}prevItem(e){if(null===e.parent)return;const t=Tree.getNodeIndex(e);return t>0?Tree.getLastItem(e.parent.children[t-1]):void 0}itemAt(e){if(!(e<0)){if(e<this.count&&this.indexLookup.tail+1===e){const t=this.indexLookup.get(this.indexLookup.tail);if(t){const r=this.nextItem(t);if(r)return this.indexLookup.set(e,r),r}}else if(e>1&&this.indexLookup.head-1===e){const t=this.indexLookup.get(this.indexLookup.head);if(t){const r=this.prevItem(t);if(r)return this.indexLookup.set(e,r),r}}return Tree.boundaries.offset=0,Tree.boundaries.length=this.count,this._itemAt(this.tree,e,Tree.boundaries)}}indexOf(e){let t=0;for(const r of this){if(e===r)return t;t++}return-1}every(e,t){let r=0;for(const n of this)if(!e.call(t,n,r++,[]))return!1;return!0}findById(e){for(const t of this)if(t.id===e)return t}invalidate(){this.wrapped=new WeakSet,this.sorted=new WeakSet,this.filtered=new WeakMap,this.invalidateLevel(this.root),this.invalidateCounter(this.root,!0),this.count=this.processTreeFragment(this.root)}invalidateCounter(e,t){let r=e;do{this.resetCounter(r),r=r.parent}while(t&&null!==r)}invalidateLevel(e){if(Tree.resetLevel(e),"children"in e)for(const t of e.children)this.invalidateLevel(t)}invalidateChildren(e){this.filtered.delete(e),this.sorted.delete(e)}wrap(e){this.wrapped.has(e)||(this.clearCache(),e.children.length>0&&(this.count-=e[COUNT]),this.wrapped.add(e),this.invalidateCounter(e,null!==e.parent&&!this.wrapped.has(e.parent)))}unwrap(e){this.wrapped.has(e)&&(this.clearCache(),this.wrapped.delete(e),this.invalidateCounter(e,null!==e.parent&&!this.wrapped.has(e.parent)),e.children.length>0&&(this.count+=e[COUNT]))}moveNode(e,t){null!==e.parent&&this.invalidateCounter(e.parent,!0),this.decorateNode(e),e.parent=t,t.children.push(e),this.clearCache(),this.invalidateCounter(t,!0),this.invalidateLevel(e)}insertNode(e,t){let r=1;this.decorateNode(e),e.parent=t,t.children.push(e),this.clearCache(),this.invalidateCounter(t,!0),this.invalidateLevel(e),"children"in e&&e.children.length>0&&(r+=this.processTreeFragment(e)),this.count+=r}insertTreeFragment(e,t){let r=0;for(const n of e)this.decorateNode(n),n.parent=t,t.children.push(n),this.invalidateLevel(n),"children"in n&&n.children.length>0&&(r+=this.processTreeFragment(n)),r++;this.clearCache(),this.invalidateCounter(t,!0),this.count+=r}removeNode(e){if(null===e.parent)throw new Error("Cannot remove root node");let t=-1;const{parent:r}=e;r.children.splice(r.children.indexOf(e),1),this.clearCache(),this.invalidateCounter(r,!0),"children"in e&&(t-=e[COUNT]),this.count+=t}replaceNode(e,t){if(null===e.parent)return assertParentNode(t),this._root=t,this.decorateNode(t),t.parent=null,void this.invalidate();let r=-1;const{parent:n}=e;n.children[n.children.indexOf(e)]=t,this.decorateNode(t),this.clearCache(),this.invalidateCounter(n,!0),"children"in e&&(r-=e[COUNT]),this.count+=r}getCount(e){return e[COUNT]}resetCounter(e){if("children"in e){let t=0;for(const r of this.getFilteredChildren(e))COUNT in r&&(t+=r[COUNT]),t+=1;e[COUNT]=t}}processTreeFragment(e){let t=0;if(this.decorateNode(e),"children"in e){if(null===this.iterationOptions||null===this.iterationOptions.expanded||this.iterationOptions.expanded(e))for(const r of this.getFilteredChildren(e))"children"in r?t+=this.processTreeFragment(r):this.decorateNode(r),t+=1;else this.wrapped.add(e);e[COUNT]=t}return t}static resetLevel(e){Object.defineProperty(e,LEVEL,Tree.level)}static resetDropZoneId(e){Object.defineProperty(e,DROP_ZONE_ID,Tree.dropZoneId)}decorateNode(e){LEVEL in e||Tree.resetLevel(e),DROP_ZONE_ID in e||Tree.resetDropZoneId(e)}static isDecoratedNode(e){return"object"==typeof e&&null!==e&&LEVEL in e&&DROP_ZONE_ID in e}static isParentNode(e){return"children"in e}static transformDeprecatedNode(e,t){const r=Object.assign(Object.assign(Object.assign({},e),e.canHaveChildren&&{children:[]}),{parent:t});return delete r.level,delete r.canHaveChildren,r}}Tree.level={configurable:!0,get(){const{parent:e}=this,t=null===e?-1:(LEVEL in e?e[LEVEL]:0)+1;return"children"in this&&Object.defineProperty(this,LEVEL,{configurable:!0,value:t}),t}},Tree.dropZoneId={configurable:!0,get(){const{parent:e}=this,t=`${null!==e&&DROP_ZONE_ID in e?`${e[DROP_ZONE_ID]}${this.id}`:this.id}-`;return"children"in this&&Object.defineProperty(this,DROP_ZONE_ID,{configurable:!0,value:t}),t}},Tree.boundaries={offset:0,length:0},__decorate([mobx.observable,__metadata("design:type",Object)],Tree.prototype,"_count",void 0),__decorate([mobx.computed,__metadata("design:type",Object),__metadata("design:paramtypes",[Object])],Tree.prototype,"count",null);class TreeState{constructor(e){var t,r,n,i,o,a;this.expanded=null!=(r=null===(t=e)||void 0===t?void 0:t.expanded)?r:{},this.activeNodeId=null!=(i=null===(n=e)||void 0===n?void 0:n.activeNodeId)?i:null,this.editedNodeId=null!=(a=null===(o=e)||void 0===o?void 0:o.editedNodeId)?a:null}}__decorate([mobx.observable.shallow,__metadata("design:type",Object)],TreeState.prototype,"expanded",void 0),__decorate([mobx.observable,__metadata("design:type",Object)],TreeState.prototype,"activeNodeId",void 0),__decorate([mobx.observable,__metadata("design:type",Object)],TreeState.prototype,"editedNodeId",void 0);class GenericTree extends Tree{constructor(e,t,r=null){const n=t(e);super(r,n),this.transformNode=t,this.transformedNodes=new WeakMap([[e,n]]),this.transformChildren(n),this.processTreeFragment(this.root),this.count=this.getCount(this.tree)}transform(e,t){const r=this.transformNode(e);return r.parent=t,r}transformChildren(e){e.children=e.children.map(t=>{const r=this.transformNode(t);return r.parent=e,super.decorateNode(r),r})}decorateNode(e){if(GenericTree.isDecoratedNode(e))return;const t=this.transform(e,e.parent&&this.transformedNodes.get(e.parent)||null);"children"in e&&(this.transformedNodes.set(e,t),this.transformChildren(t)),super.decorateNode(t)}}class ComputableTree extends Tree{constructor(e,t=null,r=Tree.createArtificialRoot(),n=200){super(t,r,n),this.visited=new WeakSet,this.computeRows=e,this.computeTree(r).then(e=>{this.insertTreeFragment(e,r)}).catch(()=>{})}computeTree(e){return __awaiter(this,void 0,void 0,function*(){const t=yield this.computeRows(e);for(const e of t)Tree.resetLevel(e),"children"in e&&(null===this.iterationOptions||null===this.iterationOptions.expanded||this.iterationOptions.expanded(e))&&(e.children=yield this.computeTree(e),yield this.computeTree(e));return t})}unwrap(e){const t=Object.create(null,{unwrap:{get:()=>super.unwrap}});return __awaiter(this,void 0,void 0,function*(){if(t.unwrap.call(this,e),0===e.children.length&&!this.visited.has(e))try{this.insertTreeFragment(yield this.computeTree(e),e)}finally{this.visited.add(e)}})}invalidate(){this.visited=new WeakSet,super.invalidate()}}mobx.configure({enforceActions:"observed"});class TreeStore{constructor(e,t,r){this.state=t,this.icons={},this.defaultExpandedDepth=0,this.instanceRef=React.createRef(),this.events=new lifecycle.EventEmitter,this.setActiveNode=(e=>{this.state.activeNodeId=e}),this.setEditedNode=(e=>{this.state.editedNodeId=e}),this.scrollToItem=(e=>{if(!this.instanceRef.current)return;"children"in e&&this.toggleExpand(e,!0);const t=this.tree.indexOf(e);-1!==t&&this.instanceRef.current.scrollToItem(t,"start")}),this.rename=((e,t)=>__awaiter(this,void 0,void 0,function*(){this.setEditedNode(e);const r=new lifecycle.DisposableCollection;try{return yield new Promise((e,n)=>{r.pushAll([this.events.on(exports.TreeListEvents.BeforeEditComplete,(e,r)=>__awaiter(this,void 0,void 0,function*(){try{void 0!==t&&(yield t(e,r)),this.events.emit(exports.TreeListEvents.AfterEditComplete,e,r)}catch(e){this.events.emit(exports.TreeListEvents.ValidationError,e)}})),this.events.on(exports.TreeListEvents.AfterEditComplete,e),this.events.on(exports.TreeListEvents.EditCancel,n)])})}finally{r.dispose(),this.setEditedNode(null)}})),this.tree=e,Object.assign(this,r),this.placeholderId=generateRandomId()}dispose(){this.events.dispose()}toggleExpand(e,t){assertParentNode(e);const{expanded:r}=this.state;if(void 0===t||t!==r[e.id]){const r=this.state.expanded[e.id]=null!=t?t:!this.isNodeExpanded(e);this.events.emit(exports.TreeListEvents.NodeExpand,e,r),r?this.tree.unwrap(e):this.tree.wrap(e)}if(!this.isNodeExpanded(e))return;const n=e.parent;null!==n&&null!==n.parent&&this.toggleExpand(n,!0)}expandAll(e){for(const t of this.tree)"children"in t&&null!==t.parent&&(void 0===e||e(t))&&this.toggleExpand(t,!0)}collapseAll(e){for(const t of this.tree)"children"in t&&null!==t.parent&&(void 0===e||e(t))&&this.toggleExpand(t,!1)}static isNodeExpanded(e,t,r){return!(e.id in t)&&Tree.getLevel(e)<=r||!0===t[e.id]}isNodeExpanded(e){return TreeStore.isNodeExpanded(e,this.state.expanded,this.defaultExpandedDepth)}isAllExpanded(){return this.tree.every(e=>null===e.parent||!("children"in e)||this.isNodeExpanded(e))}isAllCollapsed(){return this.tree.every(e=>!(null!==e.parent&&"children"in e&&this.isNodeExpanded(e)))}create(e,t,r){return __awaiter(this,void 0,void 0,function*(){const n=null===t?this.tree.root:this.tree.findById(t);assertParentNode(n);const i=Object.assign(Object.assign({name:""},e),{parent:n});this.tree.insertNode(i,n),this.toggleExpand(n,!0);try{return yield this.rename(e.id,r)}catch(e){throw this.tree.removeNode(i),e}})}}__decorate([mobx.observable.shallow,__metadata("design:type",Tree)],TreeStore.prototype,"tree",void 0),__decorate([mobx.observable,__metadata("design:type",Object)],TreeStore.prototype,"icons",void 0),__decorate([mobx.action,__metadata("design:type",Object)],TreeStore.prototype,"setActiveNode",void 0),__decorate([mobx.action,__metadata("design:type",Object)],TreeStore.prototype,"setEditedNode",void 0),__decorate([mobx.action,__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Boolean]),__metadata("design:returntype",void 0)],TreeStore.prototype,"toggleExpand",null);class Ghost{constructor(){this.attach=(e=>{null!==this.node&&(document.body.appendChild(this.node),e.dataTransfer.setDragImage(this.node,-10,-10),setTimeout(this.detach,0))}),this.detach=(()=>{var e;null===(e=this.node)||void 0===e||e.remove()}),"undefined"!=typeof document?(this.node=document.createElement("span"),this.node.className=cn(uiKit.Classes.TAG,uiKit.Classes.ROUND),this.node.style.zIndex=String(Math.pow(2,23)-10)):this.node=null}get content(){var e,t;return null!=(t=null===(e=this.node)||void 0===e?void 0:e.textContent)?t:null}set content(e){null!==this.node&&(this.node.textContent=e)}}const joinCSSRules=e=>Object.entries(e).map(e=>e.join(":")).join(";");function getHighlightStyles(){return{"background-color":"var(--highlighted-bg) !important",color:"var(--highlighted-fg) !important"}}function getGenericStyles(){return{"background-color":"inherit",color:"inherit"}}function createStyleNode(e){if("undefined"==typeof document)return;const t=document.createElement("style");return t.textContent=e,document.body.appendChild(t)}class Highlighter{constructor(e){this.rootZoneId=e,this.cache=new WeakMap}setGenericStyles(){this.genericStyle=createStyleNode(Highlighter.generateStyles("[data-drop-zone-id]:hover",getGenericStyles()))}clearGenericStyles(){void 0!==this.genericStyle&&(this.genericStyle.remove(),this.genericStyle=void 0)}setRange(e){const t=createStyleNode(Highlighter.generateStyles(null===e.parent?`[data-root-drop-zone="${this.rootZoneId}"] [data-drop-zone-id]:not([data-active-tree-node])`:`[data-drop-zone-id^="${Tree.getDropZoneId(e)}"]:not([data-active-tree-node])`,getHighlightStyles()));void 0!==t&&this.cache.set(e,t)}clearRange(e){const t=this.cache.get(e);void 0!==t&&(t.remove(),this.cache.delete(e))}static generateStyles(e,t){return`\n      ${e} { ${joinCSSRules(t)} }\n    `}}class DraggableInstance{constructor(){this.dropPermissions=new Map,this.id=DraggableInstance.seed++,this.highlighter=new Highlighter(this.id),this.ghost=new Ghost}clear(){void 0!==this.currentDragZone&&this.highlighter.clearRange(this.currentDragZone),this.highlighter.clearGenericStyles(),void 0!==this.collapseTimeout&&(this.collapseTimeout=clearTimeout(this.collapseTimeout)),this.initialNode=void 0,this.initialDragZone=void 0,this.currentDragZone=void 0,this.dropPermissions.clear()}}DraggableInstance.seed=0;const defaultContext={store:new TreeStore(new Tree,new TreeState),draggable:new DraggableInstance},TreeContext=React.createContext(defaultContext),ClassNamesContext=React.createContext({}),TreeListProvider=({store:e,className:t,innerClassName:r,itemClassName:n,children:i})=>{const o={draggable:React.useRef(new DraggableInstance).current,store:e},a={itemClassName:n,innerClassName:r,className:t};return React.createElement(TreeContext.Provider,{value:o},React.createElement(ClassNamesContext.Provider,{value:a},i))},useClassName=e=>{return React.useContext(ClassNamesContext)[e]},createMenu=e=>e.map((e,t)=>{const{divider:r,children:n}=e,i=__rest(e,["divider","children"]);return r?React.createElement(uiKit.Menu.Divider,Object.assign({key:t},i)):React.createElement(uiKit.Menu.Item,Object.assign({key:t},i),n&&n.length?createMenu(n):null)}),TreeListContextMenu=e=>React.createElement(uiKit.Menu,null,createMenu(e.items));function useDraggable(){return React.useContext(TreeContext).draggable}function useStore(){return React.useContext(TreeContext).store}const useContextMenu=(e,t)=>{const{state:{activeNodeId:r}}=useStore(),n=useDraggable();return React.useCallback(i=>{if(i.preventDefault(),i.stopPropagation(),!(t&&null!==e&&"children"in e))return;const o=t(e);o&&o.length&&(r!==e.id&&null!==e.parent&&n.highlighter.setRange(e),uiKit.ContextMenu.show(React.createElement(TreeListContextMenu,{items:o}),{left:i.clientX,top:i.clientY},()=>{n.highlighter.clearRange(e)}))},[t,r,n,e])},useNodeCallback=(e,t)=>{const r=useStore();return React.useCallback(n=>{null!==t&&r.events.emit(e,n,t)},[r,e,t])},DraggableContainer=({children:e,className:t,style:r,onContextMenu:n})=>{const i=useStore(),o=useDraggable();React.useEffect(()=>()=>{o.clear()},[o]);const a=React.useCallback(e=>{void 0!==o.currentDragZone&&o.dropPermissions.get(o.currentDragZone.id)&&e.preventDefault()},[o]),s=React.useCallback(()=>{o.clear()},[o]),l=React.useCallback(e=>{e.preventDefault();const{initialNode:t,currentDragZone:r}=o;if(void 0!==t&&void 0!==r)try{i.events.emit(exports.TreeListEvents.Drop,t,r)}catch(e){console.error("Exception thrown in drop handler",e)}o.clear()},[o,i]);return React.createElement("div",{className:t,style:r,"data-root-drop-zone":o.id,onDrop:l,onDragOver:a,onDragEnd:s,onContextMenu:n},e)},DraggableItem=mobxReactLite.observer(e=>{const{node:t,tree:r,autoExpandDelay:n,canDrop:i,canDrag:o,rowHeight:a,rowRenderer:s,className:l}=e,d=__rest(e,["node","tree","autoExpandDelay","canDrop","canDrag","rowHeight","rowRenderer","className"]),{draggable:c}=React.useContext(TreeContext),h=useStore(),u="children"in t?t:t.parent;if(null===u)throw new Error("Cannot drag root node");const p=React.useCallback(e=>{const{dropPermissions:r,currentDragZone:o,initialDragZone:a,collapseTimeout:s,initialNode:l,highlighter:d}=c;if(void 0!==s&&(c.collapseTimeout=clearTimeout(s)),void 0===a||void 0===l)return;let u=r.get(e.id);void 0===u&&(u=void 0===i||i(l,e),r.set(e.id,!!u)),void 0!==o&&d.clearRange(o),e.id!==a.id&&u?(c.currentDragZone=e,d.setRange(e),"children"in t&&(c.collapseTimeout=setTimeout(h.toggleExpand,n,t,!0))):c.currentDragZone=void 0},[t,h.toggleExpand,u,c,i]),g=React.useCallback(()=>{p(u)},[u,p]),m=React.useCallback(e=>{if(void 0!==o&&!o(t))return void e.preventDefault();c.currentDragZone=u,c.initialDragZone=u,c.initialNode=t;const r=t.parent;r&&c.dropPermissions.set(r.id,!1),c.highlighter.setGenericStyles(),e.dataTransfer.effectAllowed="copyMove",e.dataTransfer.setData("text/plain",t.id),c.ghost.content=t.name,c.ghost.attach(e),"children"in t&&h.toggleExpand(t,!1)},[t,h.toggleExpand,c,o]),f=React.useCallback(e=>{e.relatedTarget&&"closest"in e.relatedTarget&&!e.relatedTarget.closest("[data-drop-zone-id]")&&e.relatedTarget.closest("[data-root-drop-zone]")&&p(r.root)},[p,r.root]);return React.createElement("div",Object.assign({},d,{className:l,draggable:!0,onDragStart:m,onDragEnter:g,onDragLeave:f}))}),TreeListEditableItem=mobxReactLite.observer(({className:e,node:t,placeholder:r})=>{const n=useStore(),[i,o]=React.useState(null),a=React.useRef();React.useEffect(()=>n.events.on(exports.TreeListEvents.ValidationError,e=>{o(e.message)}).dispose,[n,o]),React.useEffect(()=>{const{current:e}=a;if(e){const t=e.value.indexOf(".");e.setSelectionRange(0,-1===t?e.value.length:t,"forward")}},[a.current]);const s=React.useCallback(e=>{""!==e.target.value&&o(null)},[]),l=React.useCallback(e=>{switch(e.key){case"Enter":const r=Object.assign(Object.assign({},t),{name:a.current.value});n.events.emit(exports.TreeListEvents.BeforeEditComplete,r,t.parent);break;case"Escape":d()}},[t,a.current]),d=React.useCallback(()=>{n.events.emit(exports.TreeListEvents.EditCancel)},[n]),c=React.useCallback(e=>{const t=e.target.value,r=t.indexOf(".");e.target.setSelectionRange(0,-1===r?t.length:r,"forward")},[]);return React.createElement(uiKit.Popover,{minimal:!0,isOpen:null!==i,usePortal:!0,position:uiKit.Position.BOTTOM_RIGHT,target:React.createElement("input",{autoFocus:!0,autoComplete:"off",ref:a,className:cn(e,"TreeListItem__input"),onKeyDown:l,onInput:s,onBlur:d,onFocus:c,defaultValue:t.name,placeholder:r}),content:React.createElement(uiKit.Callout,{intent:uiKit.Intent.DANGER},i)})}),DEFAULT_CARET_ICONS={[exports.TreeListCaretIcons.Down]:{default:"chevron-down"},[exports.TreeListCaretIcons.Right]:{default:"chevron-right"}},NodeCaret=e=>{var{expanded:t,node:r,store:n,children:i}=e;__rest(e,["expanded","node","store","children"]);let o=null;if("children"in r){const e=t?exports.TreeListCaretIcons.Down in n?n[exports.TreeListCaretIcons.Down]:DEFAULT_CARET_ICONS[exports.TreeListCaretIcons.Down]:exports.TreeListCaretIcons.Right in n?n[exports.TreeListCaretIcons.Right]:DEFAULT_CARET_ICONS[exports.TreeListCaretIcons.Right],i="function"==typeof e?e(r):e;i&&(o=React.createElement(uiKit.Icon,{iconSize:11,icon:i.default,className:cn(i.color&&`text-${i.color}`)}))}return React.createElement("span",{className:"TreeListItem__caret"},o)},NodeIcon=({expanded:e,store:t,node:r})=>{const n=r.type&&t[r.type]||void 0,i="function"==typeof n?n(r):n;if(!i)return null;const o=e&&i.expanded||i.default;return React.createElement("span",{className:"TreeListItem__icon"},"blank"!==o?React.createElement(uiKit.Icon,{icon:o,color:i.color}):null)},DEFAULT_AUTO_EXPAND_DELAY=800,NODE_PADDING_MULTIPLIER=15,DEFAULT_ITEM_SIZE=30,TreeListRow=mobxReactLite.observer(({className:e,isExpanded:t,isEdited:r,isExpandable:n,node:i,placeholder:o})=>{const a=useStore(),s=useNodeCallback(exports.TreeListEvents.NodeCaretClick,i);return React.createElement("div",{className:cn("flex-1 flex items-center",e),style:Object.assign({paddingLeft:15*Tree.getLevel(i)},i.style)},n&&React.createElement(NodeCaret,{onClick:s,expanded:t,store:a.icons,node:i}),React.createElement(NodeIcon,{expanded:t,store:a.icons,node:i}),r?React.createElement(TreeListEditableItem,{node:i,placeholder:o}):React.createElement("span",{className:"TreeListItem__label",title:i.name},i.name))}),TreeListItem=mobxReactLite.observer(e=>{const{data:t,index:r,style:n}=e,{innerPadding:i,tree:o,rowRenderer:a,generateContextMenu:s,striped:l}=t,d=__rest(t,["innerPadding","tree","rowRenderer","generateContextMenu","striped"]),c=useClassName("itemClassName"),h=useStore(),u=i?r-1:r,p=-1===u?null:o.itemAt(u);if(void 0===p)throw new Error("Could not find node.");const g=useNodeCallback(exports.TreeListEvents.NodeClick,p),m=useNodeCallback(exports.TreeListEvents.NodeMouseEnter,p),f=useNodeCallback(exports.TreeListEvents.NodeMouseLeave,p),v=useContextMenu(p,s);if(null===p)return React.createElement("div",{style:n});const T=h.state.editedNodeId===p.id,C=h.state.activeNodeId===p.id,x="children"in p&&h.isNodeExpanded(p),E=cn(`TreeListItem TreeListItem--${Tree.getLevel(p)}`,p.className,c,{"TreeListItem--active":C,"TreeListItem--striped":l&&u%2!=0});let N;N="function"==typeof a?a(p,{isEdited:T,isExpanded:x}):React.createElement(TreeListRow,{node:p,isEdited:T,isExpanded:x});const b=Object.assign(Object.assign({},n),i&&n&&n.top&&{top:Number(n.top)-i});return h.state.editedNodeId===p.id?React.createElement("div",{key:p.id,className:E,style:b},N):React.createElement(DraggableItem,Object.assign({key:p.id,className:E,"data-drop-zone-id":Tree.getDropZoneId(p),node:p,onClick:g,onMouseEnter:m,onMouseLeave:f,onContextMenu:v,tree:o,style:b},C&&{"data-active-tree-node":!0},d),N)}),TreeListComponent=mobxReactLite.observer(e=>{const{autoExpandDelay:t=DEFAULT_AUTO_EXPAND_DELAY,rowHeight:r=DEFAULT_ITEM_SIZE,rowRenderer:n,canDrag:i,canDrop:o,generateContextMenu:a,style:s,striped:l,innerPadding:d,maxRows:c,interactive:h=!0}=e,u=useStore(),p=useClassName("className"),g=useClassName("innerClassName"),m=useContextMenu(u.tree.root,a),f=u.instanceRef,v=u.tree;if("boolean"==typeof d&&"function"==typeof r)throw new Error("You need to provide an absolute value for padding in case of VariableSizeList");const T="boolean"==typeof d?Number(r)/2:d,C=v.count+(T?1:0);React.useEffect(()=>{null!==f.current&&"resetAfterIndex"in f.current&&f.current.resetAfterIndex(0,!0)},[C]);const x={canDrag:i,canDrop:o,autoExpandDelay:t,rowRenderer:n,rowHeight:r,innerPadding:T,tree:v,generateContextMenu:a,striped:l},E=React.useCallback(e=>{var t;return T&&0===e?u.placeholderId:(null===(t=v.itemAt(T?e-1:e))||void 0===t?void 0:t.id)||""},[v,u.placeholderId,T]),N=React.useCallback(e=>{if(0===e&&T)return 2*T;const t=T?e-1:0,n=v.itemAt(t);return"function"==typeof r&&void 0!==n?r(n,t):0},[v.count,r,T]),b={className:g,itemData:x,itemKey:E,itemCount:C,maxRows:c};return 0===C?null:React.createElement(DraggableContainer,{style:s,onContextMenu:m,className:cn(p,"TreeList",h&&"TreeList--interactive",!c&&"h-full")},"function"!=typeof r?React.createElement(ScrollList.FixedSizeList,Object.assign({},b,{instanceRef:f,itemSize:r}),TreeListItem):React.createElement(ScrollList.VariableSizeList,Object.assign({},b,{instanceRef:f,itemSize:N}),TreeListItem))}),TreeListFallbackComponent=({error:e})=>React.createElement("div",{className:"p-4"},React.createElement("b",null,"Error"),e&&`: ${e.message}`),TreeList=e=>{var{onError:t,FallbackComponent:r=TreeListFallbackComponent,store:n,className:i,innerClassName:o,itemClassName:a}=e,s=__rest(e,["onError","FallbackComponent","store","className","innerClassName","itemClassName"]);return React.createElement(reactErrorBoundary.ErrorBoundary,{onError:t,FallbackComponent:r},React.createElement(TreeListProvider,{store:n,className:i,itemClassName:a,innerClassName:o},React.createElement(TreeListComponent,Object.assign({},s))))};TreeList.displayName="TreeList",exports.ComputableTree=ComputableTree,exports.GenericTree=GenericTree,exports.Tree=Tree,exports.TreeList=TreeList,exports.TreeListEditableItem=TreeListEditableItem,exports.TreeListRow=TreeListRow,exports.TreeState=TreeState,exports.TreeStore=TreeStore;
//# sourceMappingURL=index.cjs.js.map
