"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t=require("react"),n=require("@stoplight/lifecycle"),i=require("mobx"),r=require("@stoplight/ui-kit"),o=(e=require("classnames"))&&"object"==typeof e&&"default"in e?e.default:e,s=require("mobx-react-lite"),a=require("@stoplight/react-error-boundary"),d=require("@stoplight/ui-kit/ScrollList");
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
function l(e,t,n,i){var r,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}function c(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}const h=()=>Math.random().toString(36).slice(2);class u{constructor(){this[Symbol.toStringTag]="SwappableWeakMap",this._collection=new WeakMap}delete(e){return this._collection.delete(e)}get(e){return this._collection.get(e)}set(e,t){return this._collection.set(e,t),this}has(e){return this._collection.has(e)}swap(){this._collection=new WeakMap}}class p{constructor(){this[Symbol.toStringTag]="SwappableWeakSet",this._collection=new WeakSet}delete(e){return this._collection.delete(e)}add(e){return this._collection.add(e),this}has(e){return this._collection.has(e)}swap(){this._collection=new WeakSet}}function g(e){return e===WeakMap?new u:new p}class f{constructor(e){this.size=e,this.head=-1,this.tail=-1,this.cache=new Map}set(e,t){(-1===this.head||e<this.head)&&(this.head=e),(-1===this.tail||e>this.tail)&&(this.tail=e),this.cache.size===this.size&&(e<=this.head?(this.cache.delete(this.tail),this.tail--):(this.cache.delete(this.head),this.head++)),this.cache.set(e,t)}get(e){return e<0?void 0:this.cache.get(e)}clear(e){if(e<=this.head)this.cache.clear();else{for(;e++<=this.tail;)this.cache.delete(e);this.tail=e}}}function m(e){if(!v(e))throw new TypeError("Parent node expected")}const v=e=>"object"==typeof e&&null!==e&&"children"in e,x=Symbol("COUNT"),C=Symbol("LEVEL"),y=Symbol("DROP_ZONE_ID"),N=[];class E{constructor(e=null,t=E.createArtificialRoot(),n=200){this.iterationOptions=e,this.unwrapped=g(WeakSet),this.sorted=g(WeakSet),this.filtered=g(WeakMap),this._versionCounter=0,this._count=0,this.indexLookup=new f(n),this.setRoot(t)}get root(){return this._root}get versionCounter(){return this._versionCounter}set versionCounter(e){this._versionCounter=e}get count(){return this._count}set count(e){this._count=e,this.versionCounter++}setRoot(e){this._root=e,this.invalidate()}static getLevel(e){return e[C]}static getDropZoneId(e){return e[y]}clearCache(){this.indexLookup.clear(-1)}getFilteredChildren(e){var t;if(!this.unwrapped.has(e))return N;const n=null===(t=this.iterationOptions)||void 0===t?void 0:t.filter;if(0===e.children.length)return e.children;const i=this.filtered.get(e);if(void 0!==i)return i;if(!n)return e.children;const r=e.children.filter(n);return this.filtered.set(e,r),r}getChildren(e){const t=this.getFilteredChildren(e);return null===this.iterationOptions||0===t.length?t:(null===this.iterationOptions.order||this.sorted.has(e)||(t.sort(this.iterationOptions.order),this.sorted.add(e)),t)}static _toTree(e,t){const n=[e];for(const e of t){const t=n[e.level],i=E.transformDeprecatedNode(e,null);v(i)&&(e.level>=n.length?n.push(i):n[e.level+1]=i),t&&(i.parent=t,t.children.push(i))}}static createArtificialRoot(){return{id:h(),name:"",parent:null,children:[]}}static toTree(e){const t={id:h(),name:"",parent:null,children:[]};return E._toTree(t,e.slice()),t}*[Symbol.iterator](){yield*this.getIteratorForNode(this.root)}*getIteratorForNode(e){for(const t of this.getChildren(e))yield t,v(t)&&(yield*this.getIteratorForNode(t))}static getOffsetForNode(e){return-1}_itemAt(e,t,n){if(t<0)return;const i=this.indexLookup.get(t);if(void 0!==i)return i;const{length:r}=n;for(const i of this.getChildren(e)){if(n.offset++,t===n.offset-1)return this.indexLookup.set(t,i),i;if(v(i)&&n.offset-1<=t&&t<=n.offset-1+r){n.length=i[x];const e=this._itemAt(i,t,n);if(void 0!==e)return e}else x in i&&(n.offset+=i[x])}}getLastItem(e){if(!v(e))return e;const t=this.getChildren(e);return 0===t.length?e:this.getLastItem(t[t.length-1])}_nextItem(e){if(null===e.parent)return;const t=this.getChildren(e.parent),n=0===t.length?-1:t.indexOf(e);return n<t.length-1?t[n+1]:this._nextItem(e.parent)}nextItem(e){if(v(e)){const t=this.getChildren(e);if(t.length>0)return t[0]}return this._nextItem(e)}prevItem(e){if(!v(e)||null===e.parent)return;const t=this.getChildren(e),n=0===t.length?-1:t.indexOf(e);return n>0&&t.length>0?this.getLastItem(t[n-1]):void 0}itemAt(e){if(!(e<0)){if(e<this.count&&this.indexLookup.tail+1===e){const t=this.indexLookup.get(this.indexLookup.tail);if(t){const n=this.nextItem(t);if(n)return this.indexLookup.set(e,n),n}}else if(e>1&&this.indexLookup.head-1===e){const t=this.indexLookup.get(this.indexLookup.head);if(t){const n=this.prevItem(t);if(n)return this.indexLookup.set(e,n),n}}return E.boundaries.offset=0,E.boundaries.length=this.count,this._itemAt(this.root,e,E.boundaries)}}indexOf(e){let t=0;for(const n of this){if(e===n)return t;t++}return-1}every(e,t){let n=0;for(const i of this)if(!e.call(t,i,n++,[]))return!1;return!0}findById(e){for(const t of this)if(t.id===e)return t}invalidate(){this.unwrapped.swap(),this.clearCache(),this.invalidateOrder(),this.invalidateNode(this.root),this.count=this.processTreeFragment(this.root)}forceUpdate(){this.versionCounter++}invalidateCounter(e,t){let n=e;do{this.resetCounter(n),n=n.parent}while(t&&null!==n)}invalidateLevel(e){if(E.resetLevel(e),v(e))for(const t of e.children)this.invalidateLevel(t)}invalidateNode(e){this.invalidateLevel(e),v(e)&&(this.filtered.delete(e),this.sorted.delete(e),this.invalidateCounter(e,!0))}invalidateOrder(){this.sorted.swap(),this.filtered.swap()}wrap(e){this.unwrapped.has(e)&&(this.clearCache(),this.getFilteredChildren(e).length>0&&(this.count-=e[x]),this.unwrapped.delete(e),this.invalidateCounter(e,null!==e.parent&&this.unwrapped.has(e.parent)))}unwrap(e){var t;if(!this.unwrapped.has(e)){if(this.unwrapped.add(e),null!==e.parent&&!this.unwrapped.has(e.parent))return void this.invalidateCounter(e,!1);this.clearCache();const n=this.count,i=this.getFilteredChildren(e);if(i.length>0){const e=null===(t=this.iterationOptions)||void 0===t?void 0:t.expanded;for(const t of i)!v(t)||this.unwrapped.has(t)||e&&!e(t)||this.unwrap(t)}this.invalidateCounter(e,!0),this.count=n+e[x]}}moveNode(e,t){this.removeNode(e),this.insertNode(e,t)}prepareNode(e,t){e.parent=t,t.children.push(e),v(e)&&!E.isDecoratedNode(e)?this.processTreeFragment(e):(this.decorateNode(e),this.invalidateLevel(e))}insertNode(e,t){const n=t[x];this.prepareNode(e,t),this.clearCache(),this.invalidateNode(t),this.count+=t[x]-n}insertTreeFragment(e,t){const n=t[x];for(const n of e)this.prepareNode(n,t);this.clearCache(),this.invalidateNode(t),this.count+=t[x]-n}removeNode(e){if(null===e.parent)throw new Error("Cannot remove root node");const{parent:t}=e,n=t[x];t.children.splice(t.children.indexOf(e),1),this.clearCache(),this.invalidateNode(t),this.count+=t[x]-n}replaceNode(e,t){if(null===e.parent)return m(t),void this.setRoot(t);const{parent:n}=e,i=n[x];n.children[n.children.indexOf(e)]=t,this.clearCache(),this.invalidateNode(n),this.count+=n[x]-i}getCount(e){return e[x]}setCount(e,t){e[x]=Math.max(0,t)}resetCounter(e){let t=0;for(const n of this.getFilteredChildren(e))x in n&&(t+=n[x]),t+=1;e[x]=t}processTreeFragment(e){var t;let n=0;if(this.decorateNode(e),v(e)){const i=null===(t=this.iterationOptions)||void 0===t?void 0:t.expanded;if(!i||i(e)){this.unwrapped.add(e);for(const t of this.getFilteredChildren(e))v(t)?n+=this.processTreeFragment(t):this.decorateNode(t),n+=1}e[x]=n}return n}static resetLevel(e){Object.defineProperty(e,C,E.level)}static resetDropZoneId(e){Object.defineProperty(e,y,E.dropZoneId)}decorateNode(e){C in e||E.resetLevel(e),y in e||E.resetDropZoneId(e)}static isDecoratedNode(e){return"object"==typeof e&&null!==e&&C in e&&y in e}static transformDeprecatedNode(e,t){const n={...e,...e.canHaveChildren&&{children:[]},parent:t};return delete n.level,delete n.canHaveChildren,n}}E.level={configurable:!0,get(){const{parent:e}=this,t=null===e?-1:(C in e?e[C]:0)+1;return v(this)&&Object.defineProperty(this,C,{configurable:!0,value:t}),t}},E.dropZoneId={configurable:!0,get(){const{parent:e}=this,t=`${null!==e&&y in e?`${e[y]}${this.id}`:this.id}-`;return v(this)&&Object.defineProperty(this,y,{configurable:!0,value:t}),t}},E.boundaries={offset:0,length:0},l([i.observable,c("design:type",Object)],E.prototype,"_versionCounter",void 0),l([i.computed,c("design:type",Object),c("design:paramtypes",[Object])],E.prototype,"versionCounter",null),l([i.action,c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",void 0)],E.prototype,"forceUpdate",null),l([i.action,c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",void 0)],E.prototype,"invalidateNode",null);class b{constructor(e){var t,n,i;this.expanded=null!==(t=null==e?void 0:e.expanded)&&void 0!==t?t:{},this.activeNodeId=null!==(n=null==e?void 0:e.activeNodeId)&&void 0!==n?n:null,this.editedNodeId=null!==(i=null==e?void 0:e.editedNodeId)&&void 0!==i?i:null}setExpanded(e){this.expanded=e}}l([i.observable.shallow,c("design:type",Object)],b.prototype,"expanded",void 0),l([i.observable,c("design:type",Object)],b.prototype,"activeNodeId",void 0),l([i.observable,c("design:type",Object)],b.prototype,"editedNodeId",void 0),l([i.action,c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",void 0)],b.prototype,"setExpanded",null);class w extends E{constructor(e,t,n=null){const i=t(e);super(n,i),this.transformNode=t,this.transformedNodes=new WeakMap([[e,i]]),this.transformChildren(i),this.processTreeFragment(this.root),this.count=this.getCount(this.root)}transform(e,t){const n=this.transformNode(e);return n.parent=t,n}transformChildren(e){e.children=e.children.map(t=>{const n=this.transformNode(t);return n.parent=e,super.decorateNode(n),n})}decorateNode(e){if(w.isDecoratedNode(e))return;const t=this.transform(e,e.parent&&this.transformedNodes.get(e.parent)||null);"children"in e&&(this.transformedNodes.set(e,t),this.transformChildren(t)),super.decorateNode(t)}}class T extends E{constructor(e,t=null,n=E.createArtificialRoot(),i=200){super(t,n,i),this.visited=g(WeakSet),this.computeRows=e}static mapById(e){return e.id}compute(e,t){if(!this.visited.has(e)){e.children=this.computeRows(e),void 0!==t&&(e.children=e.children.filter(e=>!t.includes(e.id)));for(const t of e.children)this.decorateNode(t);this.visited.add(e)}}processTreeFragment(e){return this.compute(e),super.processTreeFragment(e)}unwrap(e){return this.compute(e),super.unwrap(e)}insertTreeFragment(e,t){return this.compute(t,e.map(T.mapById)),super.insertTreeFragment(e,t)}insertNode(e,t){return this.compute(t,[e.id]),super.insertNode(e,t)}invalidate(){if(this.computeRows)return this.visited.swap(),super.invalidate()}}var L,I;(L=exports.TreeListEvents||(exports.TreeListEvents={})).NodeClick="node.click",L.NodeMouseEnter="node.mouseenter",L.NodeMouseLeave="node.mouseexit",L.NodeDoubleClick="node.doubleClick",L.NodeCaretClick="node.caretClick",L.NodeExpand="node.expand",L.Drop="drop",L.EditCancel="edit.cancel",L.ValidationError="edit.validationError",L.BeforeEditComplete="edit.beforecomplete",L.AfterEditComplete="edit.aftercomplete",(I=exports.TreeListCaretIcons||(exports.TreeListCaretIcons={})).Right="right",I.Down="down",i.configure({enforceActions:"observed"});class D{constructor(e,i,r){this.state=i,this.icons={},this.defaultExpandedDepth=0,this._innerPadding=null,this.instanceRef=t.createRef(),this.events=new n.EventEmitter,this.setActiveNode=e=>{this.state.activeNodeId=e},this.setEditedNode=e=>{this.state.editedNodeId=e},this.scrollToItem=e=>{if(!this.instanceRef.current)return;v(e)&&this.toggleExpand(e,!0);let t=this.tree.indexOf(e);if(-1===t)return;const n=this.instanceRef.current.props,{itemCount:i}=n;if(!D.isFixedSizeList(n))return void this.instanceRef.current.scrollToItem(t,"start");const{scrollOffset:r}=this.instanceRef.current.state;t=Math.max(0,Math.min(t+(this.innerPadding?1:0),i-1));const o=D.getOffsetForIndexAndAlignment(n,t,r,this.innerPadding);o===r||this.instanceRef.current.scrollTo(o)},this.rename=async(e,t)=>{this.setEditedNode(e.id);const i=new n.DisposableCollection;try{return await new Promise((e,n)=>{i.pushAll([this.events.on(exports.TreeListEvents.BeforeEditComplete,async(e,n)=>{try{void 0!==t&&await t(e,n),this.events.emit(exports.TreeListEvents.AfterEditComplete,e,n)}catch(e){this.events.emit(exports.TreeListEvents.ValidationError,e)}}),this.events.on(exports.TreeListEvents.AfterEditComplete,e),this.events.on(exports.TreeListEvents.EditCancel,n)])})}finally{i.dispose(),this.setEditedNode(null)}},this.tree=e,Object.assign(this,r),this.placeholderId=h()}get innerPadding(){return this._innerPadding}set innerPadding(e){this._innerPadding=e}dispose(){this.events.dispose()}static isFixedSizeList(e){return"number"==typeof e.itemSize}static getOffsetForIndexAndAlignment({direction:e,height:t,itemCount:n,itemSize:i,layout:r,width:o},s,a,d){const l=Number("horizontal"===e||"horizontal"===r?o:t)-(null!=d?d:0),c=Math.max(0,n*i-l),h=Math.min(c,s*i);return a>=Math.max(0,s*i-l+i)&&a<=h?a:h}toggleExpand(e,t){m(e);const{expanded:n}=this.state;if(void 0===t||t!==n[e.id]){const n=this.state.expanded[e.id]=null!=t?t:!this.isNodeExpanded(e);this.events.emit(exports.TreeListEvents.NodeExpand,e,n),n?this.tree.unwrap(e):this.tree.wrap(e)}if(!this.isNodeExpanded(e))return;const i=e.parent;null===i||this.isNodeExpanded(i)||this.toggleExpand(i,!0)}expandAll(e){for(const t of this.tree)v(t)&&null!==t.parent&&(void 0===e||e(t))&&this.toggleExpand(t,!0)}collapseAll(e){for(const t of this.tree)v(t)&&null!==t.parent&&(void 0===e||e(t))&&this.toggleExpand(t,!1)}static isNodeExpanded(e,t,n){return!(e.id in t)&&E.getLevel(e)<=n||!0===t[e.id]}isNodeExpanded(e){return D.isNodeExpanded(e,this.state.expanded,this.defaultExpandedDepth)}isAllExpanded(){return this.tree.every(e=>null===e.parent||!v(e)||this.isNodeExpanded(e))}isAllCollapsed(){return this.tree.every(e=>null===e.parent||!v(e)||!this.isNodeExpanded(e))}async create(e,t,n){const i=Object.assign(e,{name:"",parent:t});this.tree.invalidateNode(i),this.toggleExpand(t,!0),this.tree.insertNode(i,t);try{return await this.rename(i,n),null!==i.parent&&this.tree.invalidateNode(i.parent),i}catch(e){throw this.tree.removeNode(i),e}}}l([i.observable.shallow,c("design:type",Object)],D.prototype,"tree",void 0),l([i.observable,c("design:type",Object)],D.prototype,"icons",void 0),l([i.observable,c("design:type",Object)],D.prototype,"_innerPadding",void 0),l([i.computed,c("design:type",Object),c("design:paramtypes",[Object])],D.prototype,"innerPadding",null),l([i.action,c("design:type",Object)],D.prototype,"setActiveNode",void 0),l([i.action,c("design:type",Object)],D.prototype,"setEditedNode",void 0),l([i.action,c("design:type",Function),c("design:paramtypes",[Object,Boolean]),c("design:returntype",void 0)],D.prototype,"toggleExpand",null);class O{constructor(){this.attach=e=>{null!==this.node&&(document.body.appendChild(this.node),e.dataTransfer.setDragImage(this.node,-10,-10),setTimeout(this.detach,0))},this.detach=()=>{null!==this.node&&this.node.remove()},"undefined"!=typeof document?(this.node=document.createElement("span"),this.node.className=o(r.Classes.TAG,r.Classes.ROUND),this.node.style.zIndex=String(8388598)):this.node=null}get content(){var e,t;return null!==(t=null===(e=this.node)||void 0===e?void 0:e.textContent)&&void 0!==t?t:null}set content(e){null!==this.node&&(this.node.textContent=e)}}function k(e){if("undefined"==typeof document)return;const t=document.createElement("style");return t.textContent=e,document.body.appendChild(t)}class R{constructor(e){this.rootZoneId=e,this.cache=new WeakMap}setGenericStyles(){this.genericStyle=k(R.generateStyles("[data-drop-zone-id]:hover",{"background-color":"inherit",color:"inherit"}))}clearGenericStyles(){void 0!==this.genericStyle&&(this.genericStyle.remove(),this.genericStyle=void 0)}setRange(e){const t=k(R.generateStyles(null===e.parent?`[data-root-drop-zone="${this.rootZoneId}"] [data-drop-zone-id]:not([data-active-tree-node])`:`[data-drop-zone-id^="${E.getDropZoneId(e)}"]:not([data-active-tree-node])`,{"background-color":"var(--highlighted-bg) !important",color:"var(--highlighted-fg) !important"}));void 0!==t&&this.cache.set(e,t)}clearRange(e){const t=this.cache.get(e);void 0!==t&&(t.remove(),this.cache.delete(e))}static generateStyles(e,t){return`\n      ${e} { ${n=t,Object.entries(n).map(e=>e.join(":")).join(";")} }\n    `;var n}}class S{constructor(){this.dropPermissions=new Map,this.id=S.seed++,this.highlighter=new R(this.id),this.ghost=new O}clear(){void 0!==this.currentDragZone&&this.highlighter.clearRange(this.currentDragZone),this.highlighter.clearGenericStyles(),void 0!==this.collapseTimeout&&(this.collapseTimeout=clearTimeout(this.collapseTimeout)),this.initialNode=void 0,this.initialDragZone=void 0,this.currentDragZone=void 0,this.dropPermissions.clear()}}S.seed=0;const _={store:new D(new E,new b),draggable:new S},j=t.createContext(_),M=t.createContext({}),P=({store:e,className:n,innerClassName:i,itemClassName:r,children:o})=>{const s={draggable:t.useRef(new S).current,store:e},a={itemClassName:r,innerClassName:i,className:n};return t.createElement(j.Provider,{value:s},t.createElement(M.Provider,{value:a},o))},F=e=>t.useContext(M)[e],A=e=>e.map((e,n)=>{const{divider:i,children:o,...s}=e;return i?t.createElement(r.Menu.Divider,Object.assign({key:n},s)):t.createElement(r.Menu.Item,Object.assign({key:n},s),o&&o.length?A(o):null)}),z=e=>t.createElement(r.Menu,null,A(e.items));function Z(){return t.useContext(j).draggable}function W(){return t.useContext(j).store}const $=(e,n)=>{const{state:{activeNodeId:i}}=W(),o=Z();return t.useCallback(s=>{if(!n)return;const a=n(e);void 0!==a&&(s.preventDefault(),s.stopPropagation(),a.length>0&&(i!==e.id&&v(e)&&null!==e.parent&&o.highlighter.setRange(e),r.ContextMenu.show(t.createElement(z,{items:a}),{left:s.clientX,top:s.clientY},()=>{v(e)&&o.highlighter.clearRange(e)})))},[n,i,o,e])},B=(e,n)=>{const i=W();return t.useCallback(t=>{null!==n&&i.events.emit(e,t,n)},[i,e,n])},q=({children:e,className:n,style:i,onContextMenu:r})=>{const o=W(),s=Z();t.useEffect(()=>()=>{s.clear()},[s]);const a=t.useCallback(e=>{void 0!==s.currentDragZone&&s.dropPermissions.get(s.currentDragZone.id)&&e.preventDefault()},[s]),d=t.useCallback(()=>{s.clear()},[s]),l=t.useCallback(e=>{e.preventDefault();const{initialNode:t,currentDragZone:n}=s;try{void 0!==t&&void 0!==n&&o.events.emit(exports.TreeListEvents.Drop,t,n)}finally{s.clear()}},[s,o]);return t.createElement("div",{className:n,style:i,"data-root-drop-zone":s.id,onDrop:l,onDragOver:a,onDragEnd:d,onContextMenu:r},e)},G=s.observer(e=>{const{node:n,tree:i,autoExpandDelay:r,canDrop:o,canDrag:s,rowHeight:a,rowRenderer:d,className:l,...c}=e,{draggable:h}=t.useContext(j),u=W(),p=v(n)?n:n.parent;if(null===p)throw new Error("Cannot drag root node");const g=t.useCallback(e=>{const{dropPermissions:t,currentDragZone:i,initialDragZone:s,collapseTimeout:a,initialNode:d,highlighter:l}=h;if(void 0!==a&&(h.collapseTimeout=clearTimeout(a)),void 0===s||void 0===d)return;let c=t.get(e.id);void 0===c&&(c=void 0===o||o(d,e),t.set(e.id,!!c)),void 0!==i&&l.clearRange(i),e.id!==s.id&&c?(h.currentDragZone=e,l.setRange(e),v(n)&&(h.collapseTimeout=setTimeout(u.toggleExpand.bind(u,n,!0),r))):h.currentDragZone=void 0},[h,n,n.parent,o,u,r]),f=t.useCallback(()=>{g(p)},[p,g]),m=t.useCallback(e=>{if(void 0!==s&&!s(n))return void e.preventDefault();h.currentDragZone=p,h.initialDragZone=p,h.initialNode=n;const t=n.parent;t&&h.dropPermissions.set(t.id,!1),h.highlighter.setGenericStyles(),e.dataTransfer.effectAllowed="copyMove",e.dataTransfer.setData("text/plain",n.id),h.ghost.content=n.name,h.ghost.attach(e),v(n)&&u.toggleExpand(n,!1)},[s,n,n.parent,h.currentDragZone,h.initialDragZone,h.initialNode,h.highlighter,h.ghost,h.dropPermissions,p,u]),x=t.useCallback(e=>{e.relatedTarget&&"closest"in e.relatedTarget&&!e.relatedTarget.closest("[data-drop-zone-id]")&&e.relatedTarget.closest("[data-root-drop-zone]")&&g(i.root)},[g,i.root]);return t.createElement("div",Object.assign({},c,{className:l,draggable:!0,onDragStart:m,onDragEnter:f,onDragLeave:x}))}),V=s.observer(({className:e,node:n,placeholder:i})=>{const s=W(),[a,d]=t.useState(null),l=t.useRef();t.useEffect(()=>s.events.on(exports.TreeListEvents.ValidationError,e=>{d(e.message)}).dispose,[s,d]),t.useEffect(()=>{const{current:e}=l;if(e){const t=e.value.indexOf(".");e.setSelectionRange(0,-1===t?e.value.length:t,"forward")}},[]);const c=t.useCallback(e=>{""!==e.target.value&&d(null)},[]),h=t.useCallback(()=>{s.events.emit(exports.TreeListEvents.EditCancel)},[s]),u=t.useCallback(e=>{switch(e.key){case"Enter":n.name=l.current.value,s.events.emit(exports.TreeListEvents.BeforeEditComplete,n,n.parent);break;case"Escape":h()}},[n,s,h]),p=t.useCallback(e=>{const t=e.target.value,n=t.indexOf(".");e.target.setSelectionRange(0,-1===n?t.length:n,"forward")},[]);return t.createElement(r.Popover,{minimal:!0,isOpen:null!==a,usePortal:!0,position:r.Position.BOTTOM_RIGHT,target:t.createElement("input",{autoFocus:!0,autoComplete:"off",ref:l,className:o(e,"TreeListItem__input"),onKeyDown:u,onInput:c,onBlur:h,onFocus:p,defaultValue:n.name,placeholder:i}),content:t.createElement(r.Callout,{intent:r.Intent.DANGER},a)})}),H={[exports.TreeListCaretIcons.Down]:{default:"chevron-down"},[exports.TreeListCaretIcons.Right]:{default:"chevron-right"}},U=({expanded:e,node:n,icons:i})=>{const o=W();let s=null;if(v(n)){const a=e?exports.TreeListCaretIcons.Down in i?i[exports.TreeListCaretIcons.Down]:H[exports.TreeListCaretIcons.Down]:exports.TreeListCaretIcons.Right in i?i[exports.TreeListCaretIcons.Right]:H[exports.TreeListCaretIcons.Right],d="function"==typeof a?a.call(o,n):a;null!=d&&null!==d.default&&(s=t.createElement(r.FAIcon,{size:"sm",icon:d.default,style:{color:d.color}}))}return t.createElement("span",{className:"TreeListItem__caret"},s)};const K=s.observer(({expanded:e,icons:n,node:i})=>{const o=W(),s=void 0!==i.type?n[i.type]:void 0,a="function"==typeof s?s.call(o,i):s;if(void 0===a)return null;const d=function(e,t){return null===e?e:t&&void 0!==e.expanded?e.expanded:e.default}(a,!!e);return t.createElement("span",{className:"TreeListItem__icon"},null!=d?t.createElement(r.FAIcon,{icon:d,style:{color:null==a?void 0:a.color}}):null)}),Y=800,X=30,J=s.observer(({className:e,isExpanded:n,isEdited:i,isExpandable:r,node:s,placeholder:a})=>{const d=W(),l=B(exports.TreeListEvents.NodeCaretClick,s);return t.createElement("div",{className:o("flex-1 flex items-center",e),style:{paddingLeft:15*E.getLevel(s)}},r&&t.createElement(U,{onClick:l,expanded:n,icons:d.icons,node:s}),t.createElement(K,{expanded:n,icons:d.icons,node:s}),i?t.createElement(V,{node:s,placeholder:a}):t.createElement("span",{className:"TreeListItem__label",title:s.name},s.name))}),Q=s.observer(e=>{const{data:n,index:i,style:r}=e,{innerPadding:s,tree:a,rowRenderer:d,generateContextMenu:l,striped:c,...h}=n,u=F("itemClassName"),p=W(),g=s?i-1:i,f=-1===g?null:a.itemAt(g);if(void 0===f)throw new Error("Could not find node.");const m=B(exports.TreeListEvents.NodeClick,f),x=B(exports.TreeListEvents.NodeMouseEnter,f),C=B(exports.TreeListEvents.NodeMouseLeave,f),y=$(f,l);if(null===f)return t.createElement("div",{style:r});const N=p.state.editedNodeId===f.id,b=p.state.activeNodeId===f.id,w=v(f)&&p.isNodeExpanded(f),T=o(`TreeListItem TreeListItem--${E.getLevel(f)}`,f.className,u,{"TreeListItem--active":b,"TreeListItem--striped":c&&g%2!=0});let L;L="function"==typeof d?d(f,{isEdited:N,isExpanded:w}):t.createElement(J,{node:f,isEdited:N,isExpanded:w});const I={...r,...s&&r&&r.top&&{top:Number(r.top)-s}};return p.state.editedNodeId===f.id?t.createElement("div",{key:f.id,className:T,style:I},L):t.createElement(G,Object.assign({key:f.id,className:T,"data-drop-zone-id":E.getDropZoneId(f),node:f,onClick:m,onMouseEnter:x,onMouseLeave:C,onContextMenu:y,tree:a,style:I},b&&{"data-active-tree-node":!0},h),L)}),ee=s.observer(e=>{const{autoExpandDelay:n=Y,rowHeight:i=X,rowRenderer:r,canDrag:s,canDrop:a,generateContextMenu:l,style:c,striped:h,innerPadding:u,autoSize:p,maxRows:g,interactive:f=!0,initialScrollOffset:m,onScroll:v}=e,x=W(),C=F("className"),y=F("innerClassName"),N=$(x.tree.root,l),E=x.instanceRef,b=x.tree;if("boolean"==typeof u&&"function"==typeof i)throw new Error("You need to provide an absolute value for padding in case of VariableSizeList");const w="boolean"==typeof u?Number(i)/2:u,T=b.count+(w?1:0);t.useEffect(()=>{x.innerPadding=null!=w?w:null},[w,x]),t.useEffect(()=>{null!==E.current&&"resetAfterIndex"in E.current&&E.current.resetAfterIndex(0,!0)},[E,b.versionCounter]);const L={canDrag:s,canDrop:a,autoExpandDelay:n,rowRenderer:r,rowHeight:i,innerPadding:w,tree:b,generateContextMenu:l,striped:h},I=t.useCallback(e=>{if(w&&0===e)return x.placeholderId;const t=b.itemAt(w?e-1:e);return t?`${t.id}-${t.type}`:""},[b,x.placeholderId,w]),D=t.useCallback(e=>{if(0===e&&w)return 2*w;const t=w?e-1:e,n=b.itemAt(t);return"function"==typeof i&&void 0!==n?i(n,t):0},[w,b,i]),O={className:y,itemData:L,itemKey:I,itemCount:T,maxRows:g,initialScrollOffset:m,onScroll:v};return 0===T?null:t.createElement(q,{style:c,onContextMenu:N,className:o("TreeList",C,{"TreeList--interactive":f})},"function"!=typeof i?t.createElement(d.FixedSizeList,Object.assign({},O,{autoSize:p,instanceRef:E,itemSize:i}),Q):t.createElement(d.VariableSizeList,Object.assign({},O,{instanceRef:E,itemSize:D}),Q))}),te=({error:e})=>t.createElement("div",{className:"p-4"},t.createElement("b",null,"Error"),e&&`: ${e.message}`),ne=({onError:e,FallbackComponent:n=te,store:i,className:r,innerClassName:o,itemClassName:s,...d})=>t.createElement(a.ErrorBoundary,{onError:e,FallbackComponent:n},t.createElement(P,{store:i,className:r,itemClassName:s,innerClassName:o},t.createElement(ee,Object.assign({},d))));ne.displayName="TreeList",exports.ComputableTree=T,exports.GenericTree=w,exports.Tree=E,exports.TreeList=ne,exports.TreeListEditableItem=V,exports.TreeListRow=J,exports.TreeState=b,exports.TreeStore=D,exports.assertNode=function(e){if(void 0===e)throw new TypeError("Node expected")},exports.assertParentNode=m,exports.isDeprecatedTreeListNode=e=>"object"==typeof e&&null!==e&&"level"in e,exports.isParentNode=v,exports.useClassName=F,exports.useContextMenu=$,exports.useDraggable=Z,exports.useNodeCallback=B,exports.useStore=W;
